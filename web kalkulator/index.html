<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Toolkit Kalkulator — Aayang</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f6f8ff; --card:#ffffff; --text:#0f1724; --muted:#556; --accent:#0d6efd;
    --glass: rgba(255,255,255,0.7);
  }
  body.dark{ --bg:#070710; --card:#0b1220; --text:#e6eef8; --muted:#96a; --accent:#4a8bff; --glass: rgba(255,255,255,0.04); }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto; background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased;}
  .wrap{max-width:1100px;margin:28px auto;padding:18px;}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
  h1{font-size:20px;margin:0}
  .controls{display:flex;gap:8px;align-items:center}
  button.btn{background:var(--accent);color:white;border:0;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600}
  button.ghost{background:transparent;border:1px solid rgba(13,110,253,0.12);color:var(--text)}
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:18px}
  @media(max-width:900px){.grid{grid-template-columns:1fr}}
  .card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 10px 30px rgba(4,8,20,0.06);min-height:160px}
  .card h3{margin:0 0 8px;font-size:16px}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  input[type="text"], input[type="number"], select{padding:8px;border-radius:8px;border:1px solid #e6e9f2;background:transparent;min-width:0}
  .display{width:100%;padding:12px;border-radius:10px;background:#f1f6ff;border:1px solid #e1e7ff;font-size:18px}
  .small{font-size:13px;color:var(--muted)}
  footer{margin-top:20px;text-align:center;color:var(--muted);font-size:13px}

  /* calculator buttons (basic) */
  .pad{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:10px}
  .pad button{padding:14px;border-radius:8px;border:0;background:#f1f4ff;cursor:pointer;font-weight:700}
  .pad button.op{background:linear-gradient(90deg,#eef4ff,#fff);color:var(--accent)}
  .pad button.equal{background:var(--accent);color:white;grid-column:span 2}
  .result{margin-top:12px;font-weight:700;font-size:18px}

  /* small helpers */
  .muted{color:var(--muted);font-size:13px}
  .flexcol{display:flex;flex-direction:column;gap:8px}

</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Toolkit Kalkulator — Aayang</h1>
        <div class="small">Banyak kalkulator berguna: dasar, scientific, BMI, Mortgage, Tip, Konverter</div>
      </div>
      <div class="controls">
        <button class="ghost" onclick="document.body.classList.toggle('dark')">Toggle Dark</button>
        <button class="btn" onclick="downloadHTML()">Download HTML</button>
      </div>
    </header>

    <main class="grid">
      <!-- Basic Calculator -->
      <section class="card" id="basicCard">
        <h3>Kalkulator Dasar</h3>
        <div><input id="basicExpr" type="text" class="display" placeholder="Ketik ekspresi (contoh: 2+3*4 atau 2^3)"></div>
        <div class="pad" style="margin-top:10px">
          <button onclick="basicAppend('7')">7</button><button onclick="basicAppend('8')">8</button><button onclick="basicAppend('9')">9</button><button class="op" onclick="basicAppend('/')">÷</button>
          <button onclick="basicAppend('4')">4</button><button onclick="basicAppend('5')">5</button><button onclick="basicAppend('6')">6</button><button class="op" onclick="basicAppend('*')">×</button>
          <button onclick="basicAppend('1')">1</button><button onclick="basicAppend('2')">2</button><button onclick="basicAppend('3')">3</button><button class="op" onclick="basicAppend('-')">−</button>
          <button onclick="basicAppend('0')">0</button><button onclick="basicAppend('.')">.</button><button class="equal" onclick="basicEval()">=</button><button class="op" onclick="basicAppend('+')">+</button>
        </div>
        <div style="margin-top:10px" class="row">
          <button class="ghost" onclick="basicClear()">C</button>
          <button class="ghost" onclick="basicBack()">⌫</button>
          <div class="muted">Mendukung fungsi: sin(), cos(), tan(), sqrt(), log(), abs(), pow(a,b). Gunakan ^ juga untuk pangkat (2^3).</div>
        </div>
        <div class="result" id="basicResult"></div>
      </section>

      <!-- Scientific -->
      <section class="card">
        <h3>Kalkulator Scientific</h3>
        <div class="flexcol">
          <input id="sciExpr" type="text" placeholder="Contoh: sin(0.5)+sqrt(16) atau 2^8" class="display">
          <div class="row">
            <button class="btn" onclick="sciEval()">Hitung</button>
            <button class="ghost" onclick="copyText('sciExpr')">Salin Ekspresi</button>
            <button class="ghost" onclick="document.getElementById('sciExpr').value=''">Bersihkan</button>
          </div>
          <div class="small">Fungsi tersedia: sin, cos, tan, asin, acos, atan, sqrt, log, ln, abs, exp, pow, round, floor, ceil</div>
          <div class="result" id="sciResult"></div>
        </div>
      </section>

      <!-- BMI -->
      <section class="card">
        <h3>Kalkulator BMI</h3>
        <div class="flexcol">
          <div class="row"><label class="small">Berat (kg)</label><input id="bmiWeight" type="number" step="0.1" placeholder="contoh: 60"></div>
          <div class="row"><label class="small">Tinggi (cm)</label><input id="bmiHeight" type="number" step="0.1" placeholder="contoh: 170"></div>
          <div class="row"><button class="btn" onclick="calcBMI()">Hitung BMI</button><button class="ghost" onclick="clearBMI()">Reset</button></div>
          <div class="result" id="bmiResult"></div>
          <div class="small">Panduan WHO: <br>Underweight &lt;18.5, Normal 18.5–24.9, Overweight 25–29.9, Obese ≥30</div>
        </div>
      </section>

      <!-- Mortgage -->
      <section class="card">
        <h3>Kalkulator Hipotek / Cicilan</h3>
        <div class="flexcol">
          <div class="row"><label class="small">Pinjaman (Rp)</label><input id="mortPrincipal" type="number" step="1" placeholder="contoh: 100000000"></div>
          <div class="row"><label class="small">Tingkat bunga tahunan (%)</label><input id="mortAnnual" type="number" step="0.01" placeholder="contoh: 7.5"></div>
          <div class="row"><label class="small">Lama (tahun)</label><input id="mortYears" type="number" step="1" placeholder="contoh: 15"></div>
          <div class="row"><button class="btn" onclick="calcMortgage()">Hitung</button><button class="ghost" onclick="clearMortgage()">Reset</button></div>
          <div class="result" id="mortResult"></div>
          <div class="small">Menghitung pembayaran bulanan (fixed rate mortgage)</div>
        </div>
      </section>

      <!-- Tip -->
      <section class="card">
        <h3>Kalkulator Tip & Split</h3>
        <div class="flexcol">
          <div class="row"><label class="small">Tagihan (Rp)</label><input id="tipBill" type="number" step="0.01" placeholder="contoh: 150000"></div>
          <div class="row"><label class="small">Persen Tip (%)</label><input id="tipPercent" type="number" step="0.1" value="10"></div>
          <div class="row"><label class="small">Split (orang)</label><input id="tipSplit" type="number" step="1" value="1"></div>
          <div class="row"><button class="btn" onclick="calcTip()">Hitung</button><button class="ghost" onclick="clearTip()">Reset</button></div>
          <div class="result" id="tipResult"></div>
        </div>
      </section>

      <!-- Converter -->
      <section class="card">
        <h3>Kalkulator Konversi Satuan</h3>
        <div class="flexcol">
          <div class="row">
            <select id="convType">
              <option value="cm_in">cm → in</option>
              <option value="in_cm">in → cm</option>
              <option value="kg_lb">kg → lb</option>
              <option value="lb_kg">lb → kg</option>
              <option value="c_f">°C → °F</option>
              <option value="f_c">°F → °C</option>
            </select>
            <input id="convVal" type="number" step="0.01" placeholder="nilai">
          </div>
          <div class="row"><button class="btn" onclick="doConvert()">Konversi</button><button class="ghost" onclick="clearConv()">Reset</button></div>
          <div class="result" id="convResult"></div>
        </div>
      </section>
    </main>

    <footer>
      <div>© 2025 Aayang — Toolkit Kalkulator. Simpan & kembangkan sesuai kebutuhan.</div>
    </footer>
  </div>

<script>
/* ---------- Utilities ---------- */
function safeReplacePow(expr){
  // Replace ^ with ** (supports exponent)
  return expr.replace(/\^/g, '**');
}
function sanitizeExpression(expr){
  // allow numbers, operators, parentheses, decimal point, spaces, and letters for functions
  // but disallow suspicious characters like ; or =
  if (/[^0-9+\-*/^()., %A-Za-z_]/.test(expr)) {
    return null;
  }
  return expr;
}
function mapFunctions(expr){
  // map common functions to Math.<fn>
  const funcs = ['sin','cos','tan','asin','acos','atan','sqrt','log','abs','exp','round','floor','ceil','max','min','pow','ln'];
  funcs.forEach(f=>{
    const re = new RegExp('\\b'+f+'\\b','g');
    if(f==='ln'){
      expr = expr.replace(re, 'Math.log'); // ln -> natural log
    } else {
      expr = expr.replace(re, 'Math.'+f);
    }
  });
  return expr;
}

function evaluateExpression(raw){
  if(!raw) return NaN;
  const expr0 = raw.trim();
  const s = sanitizeExpression(expr0);
  if(s===null) throw new Error('Ekspresi mengandung karakter tidak diizinkan');
  let expr = safeReplacePow(s);
  expr = mapFunctions(expr);
  // Support percent: convert "50%" to "(50/100)"
  expr = expr.replace(/(\d+(\.\d+)?)\s*%/g, '($1/100)');
  // Create function with Math in scope
  try{
    const fn = new Function('Math', 'return ('+expr+');');
    return fn(Math);
  }catch(e){
    throw new Error('Gagal mengevaluasi ekspresi');
  }
}

/* ---------- Basic calculator ---------- */
function basicAppend(ch){
  const el = document.getElementById('basicExpr');
  el.value = el.value + ch;
  el.focus();
}
function basicClear(){
  document.getElementById('basicExpr').value='';
  document.getElementById('basicResult').textContent='';
}
function basicBack(){
  const el = document.getElementById('basicExpr');
  el.value = el.value.slice(0,-1);
}
function basicEval(){
  const raw = document.getElementById('basicExpr').value;
  try{
    const val = evaluateExpression(raw);
    const out = typeof val === 'number' && isFinite(val) ? Number(val.toFixed(10)) : val;
    document.getElementById('basicResult').textContent = 'Hasil: '+out;
  }catch(e){
    document.getElementById('basicResult').textContent = 'Error: '+e.message;
  }
}

/* ---------- Scientific ---------- */
function sciEval(){
  const raw = document.getElementById('sciExpr').value;
  try{
    const v = evaluateExpression(raw);
    const out = (typeof v === 'number' && isFinite(v)) ? Number(v.toFixed(12)) : v;
    document.getElementById('sciResult').textContent = 'Hasil: '+out;
  }catch(e){
    document.getElementById('sciResult').textContent = 'Error: '+e.message;
  }
}
function copyText(id){
  const v = document.getElementById(id).value;
  navigator.clipboard?.writeText(v);
  alert('Tersalin ke clipboard');
}

/* ---------- BMI ---------- */
function calcBMI(){
  const w = parseFloat(document.getElementById('bmiWeight').value);
  const hcm = parseFloat(document.getElementById('bmiHeight').value);
  if(!w || !hcm){ document.getElementById('bmiResult').textContent='Masukkan berat dan tinggi yang valid'; return; }
  const h = hcm/100;
  const bmi = w / (h*h);
  const bmiRounded = Math.round(bmi*10)/10;
  let cat = '';
  if(bmi < 18.5) cat='Underweight';
  else if(bmi < 25) cat='Normal';
  else if(bmi < 30) cat='Overweight';
  else cat='Obese';
  document.getElementById('bmiResult').textContent = `BMI: ${bmiRounded} — ${cat}`;
}
function clearBMI(){ document.getElementById('bmiWeight').value=''; document.getElementById('bmiHeight').value=''; document.getElementById('bmiResult').textContent=''; }

/* ---------- Mortgage ---------- */
function calcMortgage(){
  const P = parseFloat(document.getElementById('mortPrincipal').value);
  const annual = parseFloat(document.getElementById('mortAnnual').value);
  const years = parseFloat(document.getElementById('mortYears').value);
  if(!P || !years || isNaN(annual)){ document.getElementById('mortResult').textContent='Masukkan nilai yang valid'; return; }
  const r = (annual/100)/12; // monthly rate
  const n = years * 12;
  let M;
  if(r === 0){
    M = P / n;
  } else {
    // M = P * r * (1+r)^n / ((1+r)^n - 1)
    const pow = Math.pow(1+r, n);
    M = P * r * pow / (pow - 1);
  }
  const total = M * n;
  document.getElementById('mortResult').textContent = `Pembayaran bulanan: Rp ${formatNumber(M.toFixed(0))} • Total bayar: Rp ${formatNumber(Math.round(total))}`;
}
function clearMortgage(){ document.getElementById('mortPrincipal').value=''; document.getElementById('mortAnnual').value=''; document.getElementById('mortYears').value=''; document.getElementById('mortResult').textContent=''; }

/* ---------- Tip ---------- */
function calcTip(){
  const bill = parseFloat(document.getElementById('tipBill').value);
  const pct = parseFloat(document.getElementById('tipPercent').value);
  const split = parseInt(document.getElementById('tipSplit').value) || 1;
  if(isNaN(bill) || isNaN(pct) || bill<0){ document.getElementById('tipResult').textContent='Masukkan nilai yang valid'; return; }
  const tip = bill * (pct/100);
  const total = bill + tip;
  const each = total / split;
  document.getElementById('tipResult').textContent = `Tip: Rp ${formatNumber(Math.round(tip))} • Total: Rp ${formatNumber(Math.round(total))} • Per orang: Rp ${formatNumber(Math.round(each))}`;
}
function clearTip(){ document.getElementById('tipBill').value=''; document.getElementById('tipPercent').value='10'; document.getElementById('tipSplit').value='1'; document.getElementById('tipResult').textContent=''; }

/* ---------- Converter ---------- */
function doConvert(){
  const type = document.getElementById('convType').value;
  const val = parseFloat(document.getElementById('convVal').value);
  if(isNaN(val)){ document.getElementById('convResult').textContent='Masukkan nilai valid'; return; }
  let out='';
  switch(type){
    case 'cm_in': out = `${val} cm = ${(val/2.54).toFixed(4)} in`; break;
    case 'in_cm': out = `${val} in = ${(val*2.54).toFixed(4)} cm`; break;
    case 'kg_lb': out = `${val} kg = ${(val*2.2046226218).toFixed(4)} lb`; break;
    case 'lb_kg': out = `${val} lb = ${(val/2.2046226218).toFixed(4)} kg`; break;
    case 'c_f': out = `${val} °C = ${(val*9/5+32).toFixed(2)} °F`; break;
    case 'f_c': out = `${val} °F = ${((val-32)*5/9).toFixed(2)} °C`; break;
  }
  document.getElementById('convResult').textContent = out;
}
function clearConv(){ document.getElementById('convVal').value=''; document.getElementById('convResult').textContent=''; }

/* ---------- Helpers ---------- */
function formatNumber(x){ return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."); }

/* ---------- Download page ---------- */
function downloadHTML(){
  const blob = new Blob([document.documentElement.outerHTML], {type:'text/html'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'kalkulator_toolkit.html';
  a.click();
  URL.revokeObjectURL(url);
}

/* initialize small */
document.addEventListener('keydown', function(e){
  if(e.key === 'Enter' && document.activeElement.id === 'basicExpr') { basicEval(); }
  if(e.key === 'Enter' && document.activeElement.id === 'sciExpr') { sciEval(); }
});
</script>
</body>
</html>
<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Toolkit Kalkulator — Aayang</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f6f8ff; --card:#ffffff; --text:#0f1724; --muted:#556; --accent:#0d6efd;
    --glass: rgba(255,255,255,0.7);
  }
  body.dark{ --bg:#070710; --card:#0b1220; --text:#e6eef8; --muted:#96a; --accent:#4a8bff; --glass: rgba(255,255,255,0.04); }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto; background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased;}
  .wrap{max-width:1100px;margin:28px auto;padding:18px;}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
  h1{font-size:20px;margin:0}
  .controls{display:flex;gap:8px;align-items:center}
  button.btn{background:var(--accent);color:white;border:0;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600}
  button.ghost{background:transparent;border:1px solid rgba(13,110,253,0.12);color:var(--text)}
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:18px}
  @media(max-width:900px){.grid{grid-template-columns:1fr}}
  .card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 10px 30px rgba(4,8,20,0.06);min-height:160px}
  .card h3{margin:0 0 8px;font-size:16px}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  input[type="text"], input[type="number"], select{padding:8px;border-radius:8px;border:1px solid #e6e9f2;background:transparent;min-width:0}
  .display{width:100%;padding:12px;border-radius:10px;background:#f1f6ff;border:1px solid #e1e7ff;font-size:18px}
  .small{font-size:13px;color:var(--muted)}
  footer{margin-top:20px;text-align:center;color:var(--muted);font-size:13px}

  /* calculator buttons (basic) */
  .pad{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:10px}
  .pad button{padding:14px;border-radius:8px;border:0;background:#f1f4ff;cursor:pointer;font-weight:700}
  .pad button.op{background:linear-gradient(90deg,#eef4ff,#fff);color:var(--accent)}
  .pad button.equal{background:var(--accent);color:white;grid-column:span 2}
  .result{margin-top:12px;font-weight:700;font-size:18px}

  /* small helpers */
  .muted{color:var(--muted);font-size:13px}
  .flexcol{display:flex;flex-direction:column;gap:8px}

</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Toolkit Kalkulator — Aayang</h1>
        <div class="small">Banyak kalkulator berguna: dasar, scientific, BMI, Mortgage, Tip, Konverter</div>
      </div>
      <div class="controls">
        <button class="ghost" onclick="document.body.classList.toggle('dark')">Toggle Dark</button>
        <button class="btn" onclick="downloadHTML()">Download HTML</button>
      </div>
    </header>

    <main class="grid">
      <!-- Basic Calculator -->
      <section class="card" id="basicCard">
        <h3>Kalkulator Dasar</h3>
        <div><input id="basicExpr" type="text" class="display" placeholder="Ketik ekspresi (contoh: 2+3*4 atau 2^3)"></div>
        <div class="pad" style="margin-top:10px">
          <button onclick="basicAppend('7')">7</button><button onclick="basicAppend('8')">8</button><button onclick="basicAppend('9')">9</button><button class="op" onclick="basicAppend('/')">÷</button>
          <button onclick="basicAppend('4')">4</button><button onclick="basicAppend('5')">5</button><button onclick="basicAppend('6')">6</button><button class="op" onclick="basicAppend('*')">×</button>
          <button onclick="basicAppend('1')">1</button><button onclick="basicAppend('2')">2</button><button onclick="basicAppend('3')">3</button><button class="op" onclick="basicAppend('-')">−</button>
          <button onclick="basicAppend('0')">0</button><button onclick="basicAppend('.')">.</button><button class="equal" onclick="basicEval()">=</button><button class="op" onclick="basicAppend('+')">+</button>
        </div>
        <div style="margin-top:10px" class="row">
          <button class="ghost" onclick="basicClear()">C</button>
          <button class="ghost" onclick="basicBack()">⌫</button>
          <div class="muted">Mendukung fungsi: sin(), cos(), tan(), sqrt(), log(), abs(), pow(a,b). Gunakan ^ juga untuk pangkat (2^3).</div>
        </div>
        <div class="result" id="basicResult"></div>
      </section>

      <!-- Scientific -->
      <section class="card">
        <h3>Kalkulator Scientific</h3>
        <div class="flexcol">
          <input id="sciExpr" type="text" placeholder="Contoh: sin(0.5)+sqrt(16) atau 2^8" class="display">
          <div class="row">
            <button class="btn" onclick="sciEval()">Hitung</button>
            <button class="ghost" onclick="copyText('sciExpr')">Salin Ekspresi</button>
            <button class="ghost" onclick="document.getElementById('sciExpr').value=''">Bersihkan</button>
          </div>
          <div class="small">Fungsi tersedia: sin, cos, tan, asin, acos, atan, sqrt, log, ln, abs, exp, pow, round, floor, ceil</div>
          <div class="result" id="sciResult"></div>
        </div>
      </section>

      <!-- BMI -->
      <section class="card">
        <h3>Kalkulator BMI</h3>
        <div class="flexcol">
          <div class="row"><label class="small">Berat (kg)</label><input id="bmiWeight" type="number" step="0.1" placeholder="contoh: 60"></div>
          <div class="row"><label class="small">Tinggi (cm)</label><input id="bmiHeight" type="number" step="0.1" placeholder="contoh: 170"></div>
          <div class="row"><button class="btn" onclick="calcBMI()">Hitung BMI</button><button class="ghost" onclick="clearBMI()">Reset</button></div>
          <div class="result" id="bmiResult"></div>
          <div class="small">Panduan WHO: <br>Underweight &lt;18.5, Normal 18.5–24.9, Overweight 25–29.9, Obese ≥30</div>
        </div>
      </section>

      <!-- Mortgage -->
      <section class="card">
        <h3>Kalkulator Hipotek / Cicilan</h3>
        <div class="flexcol">
          <div class="row"><label class="small">Pinjaman (Rp)</label><input id="mortPrincipal" type="number" step="1" placeholder="contoh: 100000000"></div>
          <div class="row"><label class="small">Tingkat bunga tahunan (%)</label><input id="mortAnnual" type="number" step="0.01" placeholder="contoh: 7.5"></div>
          <div class="row"><label class="small">Lama (tahun)</label><input id="mortYears" type="number" step="1" placeholder="contoh: 15"></div>
          <div class="row"><button class="btn" onclick="calcMortgage()">Hitung</button><button class="ghost" onclick="clearMortgage()">Reset</button></div>
          <div class="result" id="mortResult"></div>
          <div class="small">Menghitung pembayaran bulanan (fixed rate mortgage)</div>
        </div>
      </section>

      <!-- Tip -->
      <section class="card">
        <h3>Kalkulator Tip & Split</h3>
        <div class="flexcol">
          <div class="row"><label class="small">Tagihan (Rp)</label><input id="tipBill" type="number" step="0.01" placeholder="contoh: 150000"></div>
          <div class="row"><label class="small">Persen Tip (%)</label><input id="tipPercent" type="number" step="0.1" value="10"></div>
          <div class="row"><label class="small">Split (orang)</label><input id="tipSplit" type="number" step="1" value="1"></div>
          <div class="row"><button class="btn" onclick="calcTip()">Hitung</button><button class="ghost" onclick="clearTip()">Reset</button></div>
          <div class="result" id="tipResult"></div>
        </div>
      </section>

      <!-- Converter -->
      <section class="card">
        <h3>Kalkulator Konversi Satuan</h3>
        <div class="flexcol">
          <div class="row">
            <select id="convType">
              <option value="cm_in">cm → in</option>
              <option value="in_cm">in → cm</option>
              <option value="kg_lb">kg → lb</option>
              <option value="lb_kg">lb → kg</option>
              <option value="c_f">°C → °F</option>
              <option value="f_c">°F → °C</option>
            </select>
            <input id="convVal" type="number" step="0.01" placeholder="nilai">
          </div>
          <div class="row"><button class="btn" onclick="doConvert()">Konversi</button><button class="ghost" onclick="clearConv()">Reset</button></div>
          <div class="result" id="convResult"></div>
        </div>
      </section>
    </main>

    <footer>
      <div>© 2025 Aayang — Toolkit Kalkulator. Simpan & kembangkan sesuai kebutuhan.</div>
    </footer>
  </div>

<script>
/* ---------- Utilities ---------- */
function safeReplacePow(expr){
  // Replace ^ with ** (supports exponent)
  return expr.replace(/\^/g, '**');
}
function sanitizeExpression(expr){
  // allow numbers, operators, parentheses, decimal point, spaces, and letters for functions
  // but disallow suspicious characters like ; or =
  if (/[^0-9+\-*/^()., %A-Za-z_]/.test(expr)) {
    return null;
  }
  return expr;
}
function mapFunctions(expr){
  // map common functions to Math.<fn>
  const funcs = ['sin','cos','tan','asin','acos','atan','sqrt','log','abs','exp','round','floor','ceil','max','min','pow','ln'];
  funcs.forEach(f=>{
    const re = new RegExp('\\b'+f+'\\b','g');
    if(f==='ln'){
      expr = expr.replace(re, 'Math.log'); // ln -> natural log
    } else {
      expr = expr.replace(re, 'Math.'+f);
    }
  });
  return expr;
}

function evaluateExpression(raw){
  if(!raw) return NaN;
  const expr0 = raw.trim();
  const s = sanitizeExpression(expr0);
  if(s===null) throw new Error('Ekspresi mengandung karakter tidak diizinkan');
  let expr = safeReplacePow(s);
  expr = mapFunctions(expr);
  // Support percent: convert "50%" to "(50/100)"
  expr = expr.replace(/(\d+(\.\d+)?)\s*%/g, '($1/100)');
  // Create function with Math in scope
  try{
    const fn = new Function('Math', 'return ('+expr+');');
    return fn(Math);
  }catch(e){
    throw new Error('Gagal mengevaluasi ekspresi');
  }
}

/* ---------- Basic calculator ---------- */
function basicAppend(ch){
  const el = document.getElementById('basicExpr');
  el.value = el.value + ch;
  el.focus();
}
function basicClear(){
  document.getElementById('basicExpr').value='';
  document.getElementById('basicResult').textContent='';
}
function basicBack(){
  const el = document.getElementById('basicExpr');
  el.value = el.value.slice(0,-1);
}
function basicEval(){
  const raw = document.getElementById('basicExpr').value;
  try{
    const val = evaluateExpression(raw);
    const out = typeof val === 'number' && isFinite(val) ? Number(val.toFixed(10)) : val;
    document.getElementById('basicResult').textContent = 'Hasil: '+out;
  }catch(e){
    document.getElementById('basicResult').textContent = 'Error: '+e.message;
  }
}

/* ---------- Scientific ---------- */
function sciEval(){
  const raw = document.getElementById('sciExpr').value;
  try{
    const v = evaluateExpression(raw);
    const out = (typeof v === 'number' && isFinite(v)) ? Number(v.toFixed(12)) : v;
    document.getElementById('sciResult').textContent = 'Hasil: '+out;
  }catch(e){
    document.getElementById('sciResult').textContent = 'Error: '+e.message;
  }
}
function copyText(id){
  const v = document.getElementById(id).value;
  navigator.clipboard?.writeText(v);
  alert('Tersalin ke clipboard');
}

/* ---------- BMI ---------- */
function calcBMI(){
  const w = parseFloat(document.getElementById('bmiWeight').value);
  const hcm = parseFloat(document.getElementById('bmiHeight').value);
  if(!w || !hcm){ document.getElementById('bmiResult').textContent='Masukkan berat dan tinggi yang valid'; return; }
  const h = hcm/100;
  const bmi = w / (h*h);
  const bmiRounded = Math.round(bmi*10)/10;
  let cat = '';
  if(bmi < 18.5) cat='Underweight';
  else if(bmi < 25) cat='Normal';
  else if(bmi < 30) cat='Overweight';
  else cat='Obese';
  document.getElementById('bmiResult').textContent = `BMI: ${bmiRounded} — ${cat}`;
}
function clearBMI(){ document.getElementById('bmiWeight').value=''; document.getElementById('bmiHeight').value=''; document.getElementById('bmiResult').textContent=''; }

/* ---------- Mortgage ---------- */
function calcMortgage(){
  const P = parseFloat(document.getElementById('mortPrincipal').value);
  const annual = parseFloat(document.getElementById('mortAnnual').value);
  const years = parseFloat(document.getElementById('mortYears').value);
  if(!P || !years || isNaN(annual)){ document.getElementById('mortResult').textContent='Masukkan nilai yang valid'; return; }
  const r = (annual/100)/12; // monthly rate
  const n = years * 12;
  let M;
  if(r === 0){
    M = P / n;
  } else {
    // M = P * r * (1+r)^n / ((1+r)^n - 1)
    const pow = Math.pow(1+r, n);
    M = P * r * pow / (pow - 1);
  }
  const total = M * n;
  document.getElementById('mortResult').textContent = `Pembayaran bulanan: Rp ${formatNumber(M.toFixed(0))} • Total bayar: Rp ${formatNumber(Math.round(total))}`;
}
function clearMortgage(){ document.getElementById('mortPrincipal').value=''; document.getElementById('mortAnnual').value=''; document.getElementById('mortYears').value=''; document.getElementById('mortResult').textContent=''; }

/* ---------- Tip ---------- */
function calcTip(){
  const bill = parseFloat(document.getElementById('tipBill').value);
  const pct = parseFloat(document.getElementById('tipPercent').value);
  const split = parseInt(document.getElementById('tipSplit').value) || 1;
  if(isNaN(bill) || isNaN(pct) || bill<0){ document.getElementById('tipResult').textContent='Masukkan nilai yang valid'; return; }
  const tip = bill * (pct/100);
  const total = bill + tip;
  const each = total / split;
  document.getElementById('tipResult').textContent = `Tip: Rp ${formatNumber(Math.round(tip))} • Total: Rp ${formatNumber(Math.round(total))} • Per orang: Rp ${formatNumber(Math.round(each))}`;
}
function clearTip(){ document.getElementById('tipBill').value=''; document.getElementById('tipPercent').value='10'; document.getElementById('tipSplit').value='1'; document.getElementById('tipResult').textContent=''; }

/* ---------- Converter ---------- */
function doConvert(){
  const type = document.getElementById('convType').value;
  const val = parseFloat(document.getElementById('convVal').value);
  if(isNaN(val)){ document.getElementById('convResult').textContent='Masukkan nilai valid'; return; }
  let out='';
  switch(type){
    case 'cm_in': out = `${val} cm = ${(val/2.54).toFixed(4)} in`; break;
    case 'in_cm': out = `${val} in = ${(val*2.54).toFixed(4)} cm`; break;
    case 'kg_lb': out = `${val} kg = ${(val*2.2046226218).toFixed(4)} lb`; break;
    case 'lb_kg': out = `${val} lb = ${(val/2.2046226218).toFixed(4)} kg`; break;
    case 'c_f': out = `${val} °C = ${(val*9/5+32).toFixed(2)} °F`; break;
    case 'f_c': out = `${val} °F = ${((val-32)*5/9).toFixed(2)} °C`; break;
  }
  document.getElementById('convResult').textContent = out;
}
function clearConv(){ document.getElementById('convVal').value=''; document.getElementById('convResult').textContent=''; }

/* ---------- Helpers ---------- */
function formatNumber(x){ return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."); }

/* ---------- Download page ---------- */
function downloadHTML(){
  const blob = new Blob([document.documentElement.outerHTML], {type:'text/html'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'kalkulator_toolkit.html';
  a.click();
  URL.revokeObjectURL(url);
}

/* initialize small */
document.addEventListener('keydown', function(e){
  if(e.key === 'Enter' && document.activeElement.id === 'basicExpr') { basicEval(); }
  if(e.key === 'Enter' && document.activeElement.id === 'sciExpr') { sciEval(); }
});
</script>
</body>
</html>
